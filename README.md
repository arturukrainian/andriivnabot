README.md
# üß† English Learning Telegram Bot by ANDRIIVNA

## üí° –û–ø–∏—Å

–¶–µ Telegram-–±–æ—Ç –¥–ª—è —Å–ø—ñ–ª—å–Ω–æ—Ç–∏, —â–æ –≤–∏–≤—á–∞—î –∞–Ω–≥–ª—ñ–π—Å—å–∫—É –º–æ–≤—É.  
–ö–æ–∂–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–æ—Ñ—ñ–ª—å —ñ–∑ –ø—Ä–æ–≥—Ä–µ—Å–æ–º, –º–æ–∂–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ —É—Ä–æ–∫–∏, —Ç–µ—Å—Ç–∏-—ñ–≥—Ä–∏, –¥–∏–≤–∏—Ç–∏—Å—è –≤—ñ–¥–µ–æ —Ç–∞ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –∑–≤‚Äô—è–∑–æ–∫.  
–£ –º–∞–π–±—É—Ç–Ω—å–æ–º—É ‚Äî –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ —ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—è –∞–¥–º—ñ–Ω–∫–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç—É.

---

## üéØ –¶—ñ–ª—ñ MVP

- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–µ—Ä–µ–∑ `/start`
- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é
- –Ü–≥—Ä–∏-—Ç–µ—Å—Ç–∏ (quiz)
- –ö–Ω–æ–ø–∫–∞ –∑ –≤—ñ–¥–µ–æ-—É—Ä–æ–∫–æ–º (YouTube)
- –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ (PostHog)
- –ê–¥–º—ñ–Ω–∫–∞ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —É—Ä–æ–∫—ñ–≤ —ñ –ø–µ—Ä–µ–≥–ª—è–¥—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ù–∞–¥—ñ–π–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∑ —á–µ—Ä–≥–∞–º–∏ (ack-fast)

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç    | –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—è                  |
| ------------ | --------------------------- |
| –ú–æ–≤–∞         | Node.js + TypeScript        |
| Telegram SDK | grammY                      |
| –í–µ–±—Å–µ—Ä–≤–µ—Ä    | Fastify                     |
| –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö   | Postgres (Neon / Cloud SQL) |
| ORM          | Prisma                      |
| –ß–µ—Ä–≥–∞        | GCP Pub/Sub                 |
| –ö–µ—à / —Å–µ—Å—ñ—ó  | Redis (Upstash)             |
| –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞    | PostHog                     |
| Edge / WAF   | Cloudflare                  |
| –•–æ—Å—Ç–∏–Ω–≥      | GCP Cloud Run               |
| CI/CD        | GitHub Actions              |

---

## üß© –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ (–æ–≥–ª—è–¥)

Telegram ‚Üí Cloudflare (Edge/WAF)
‚Üí Cloud Run "ingest" (–≤–µ–±—Ö—É–∫)
‚Üí Pub/Sub (—á–µ—Ä–≥–∞)
‚Üí Cloud Run "workers"
‚Üí Postgres / Redis ‚Üí Telegram API

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- [docs/ARCHITECTURE.md](./docs/ARCHITECTURE.md)
- [docs/DEVELOPMENT_PLAN.md](./docs/DEVELOPMENT_PLAN.md)

## üõ†Ô∏è Local env

- –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–º—ñ–Ω–Ω—ñ: `source scripts/local-env.sh`
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è: `source scripts/local-env.sh && scripts/print-env.sh`

---

## üìà –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞

–Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ PostHog –≤–∏–º–∏–∫–∞—î—Ç—å—Å—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.  
–©–æ–± —É–≤—ñ–º–∫–Ω—É—Ç–∏:

1. –ó–∞–¥–∞–π—Ç–µ —É `.env`:
   ```env
   ANALYTICS_ENABLED=1
   POSTHOG_API_KEY=phc_xxx
   POSTHOG_HOST=https://us.i.posthog.com # –∞–±–æ https://eu.i.posthog.com
   # (–æ–ø—Ü—ñ–π–Ω–æ) ANALYTICS_DEBUG=1 ‚Äî –ª–æ–≥—É–≤–∞—Ç–∏ –∫–æ–∂–Ω—É –ø–æ–¥—ñ—é
   ```
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å ingest —Ç–∞ worker-—Å–µ—Ä–≤—ñ—Å–∏.

–ü–æ–¥—ñ—ó (`app_start`, `webhook_received`, `lesson_start`, `quiz_answer`, `update_dropped_duplicate`, `chat_lock_contention`, `ratelimit_drop`) –¥—É–±–ª—é—é—Ç—å—Å—è –≤ PostHog —ñ —É `/metrics` —è–∫ `analytics_events_total{name="<event>"}` / `analytics_errors_total`.

## üìä –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ (Stage 5)

- **–Ø–∫ —É–≤—ñ–º–∫–Ω—É—Ç–∏:** –≤–∏—Å—Ç–∞–≤—ñ—Ç—å `ANALYTICS_ENABLED=1`, `POSTHOG_API_KEY`, `POSTHOG_HOST` —É `.env`, –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ `ANALYTICS_DEBUG=1`, –ø—ñ—Å–ª—è —á–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å ingest —ñ worker. –Ø–∫—â–æ –∫–ª—é—á –Ω–µ –∑–∞–¥–∞–Ω–æ, –º–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å —É no-op —Ä–µ–∂–∏–º –±–µ–∑ –ø–∞–¥—ñ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—ñ–≤.
- **–©–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:** –≤—ñ–¥–∫—Ä–∏–π—Ç–µ `GET /metrics` ‚Äî —Ç–∞–º –∑‚Äô—è–≤–ª—è—Ç—å—Å—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ `analytics_events_total{name="<event>"}` —ñ –∑–∞–≥–∞–ª—å–Ω–∏–π `analytics_errors_total`. –î–ª—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É `analytics_errors_total` –ø–æ–≤–∏–Ω–µ–Ω –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ `0`.
- **–Ø–∫—ñ –ø–æ–¥—ñ—ó —Ç—Ä–µ–∫–∞—é—Ç—å—Å—è:** `app_start`, `webhook_received`, `lesson_start`, `quiz_answer`, `update_dropped_duplicate`, `chat_lock_contention`, `ratelimit_drop`. –£—Å—ñ –≤–æ–Ω–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è —É PostHog —Ç–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–æ —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç—É—é—Ç—å Prometheus-–º–µ—Ç—Ä–∏–∫–∏.
- **–Ø–∫ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏:** –∑–∞–ø—É—Å—Ç—ñ—Ç—å `npm run verify:stage4 -- --boot` —ñ–∑ –≤–≤—ñ–º–∫–Ω–µ–Ω–æ—é –∞–Ω–∞–ª—ñ—Ç–∏–∫–æ—é, –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —É –ª–æ–≥–∞—Ö/`/metrics`, —â–æ `analytics_errors_total == 0`, –∞ —Å–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è `‚úÖ Stage4 E2E passed`.
